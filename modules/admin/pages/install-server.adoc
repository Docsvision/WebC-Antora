= Установка и конфигурация серверного расширения

Серверное расширение {wc} должно быть установлено на компьютер с _сервером {dv}_ до установки (настройки) модуля _{wc}_.

[#linux]
== Установка на Linux

. Обновите индекс пакетов и установите сервер {wc}а командами:
+
[source,bash]
----
sudo apt-get update
sudo apt-get install docsvision-webclient
----

Пользователь, выполняющий настройку {dv}, должен являться локальным администратором (быть указанным в файле sudoers).

[WARNING]
====
Если в {wc}е планируется работать с xref:user:directories/nomenclature/directory.adoc[функциями] модуля _{am}_, установите серверную часть модуля _{am}_ на компьютер с сервером {dv} *перед* установкой серверного расширения {wc}а.

Если {wc} уже установлен и планируется дополнительно установить модуль _{am}_ выполните следующие действия:

. Установите сначала модуль _{am}_.
. Затем xref:update-module.adoc[обновите {wc}] с установкой компонентов управления архивом.
====

[#windows]
== Установка на Windows

Пользователь, выполняющий установку, должен обладать правами администратора.

.Чтобы установить серверное расширение {wc}:
. *Запустите пакет установки* `{dv} web-client server extension.msi`.
+
. *Примите условия лицензионного соглашения*, чтобы продолжить установку.
+
.Условия лицензионного соглашения
image::install-server-license.png[Условия лицензионного соглашения]
+
// . Установите или обновите необходимые модули, если проверка не пройдена. xref:ROOT:requirements-dv.adoc#checkVersions[Подробнее] о проверке.
// +
// .Проверка требуемых модулей
// image::install-server-check.png[Проверка требуемых модулей]
// +
. Если требуется, измените каталог установки Расширения.
+
.Каталог установки Расширения
image::install-server-location.png[Каталог установки Расширения]
+
. Выберите необходимые компоненты установки.
+
// tag::components[]
* Компоненты {wc}а -- компоненты, необходимые для работы {wc}а. Обязательны к установке, неотключаемы.
* [[archive]]Компоненты Управления Архивом -- компоненты, открывающие возможность работы с функциями модуля _{am}_ в {wc}е. Обязательны к установке, если планируется работа с модулем _{am}_. Компоненты недоступны для установки, если не установлен модуль _{am}_.
ifdef::client[]
* {kvr} -- компоненты программы для работы с Web-разметками {kvr} может быть установлен вместе с сервером {wc}а и/или на отдельный компьютер (см. xref:install-layout-designer.adoc[Отдельная установка программы {kvr}]).
endif::client[]
* [[edi]]Компоненты модуля интеграции с операторами ЭДО -- компоненты {wc}а, необходимые для работы с модулем _{em}_.
+
Компоненты отображаются только если установлен _{em}_ версии {edi-v} и выше.
// end::components[]
+
.Выбор компонентов
image::install-server-components.png[Выбор компонентов]
+
. Нажмите на кнопку *Установить* и дождитесь завершения установки Расширения.
+
.Установка Расширения
image::install-server-confirm.png[Установка Расширения]
+
// . В процессе установки появится окно выбора БД. Выберите базы данных {dv}, в которые будет установлено расширение {wc}.
// +
// .Окно выбора баз данных для установки расширения
// image::install-db.png[Окно выбора баз данных для установки расширения]
// +
// Выберите все базы данных, к которым будет подключен {wc}, и нажмите кнопку *ОК*. База данных по умолчанию выделена жирным шрифтом.
// +
// [WARNING]
// ====
// * Если модуль устанавливается впервые и настройки ещё не были загружены в БД, в диалоге выберите *Отмена*.
// * {blank}
// +
// --
// include::partial$excerpts.adoc[tags=nonoyet]
// --
// ====
// +
// Дождитесь завершения установки расширения.
// +
// . Согласитесь с перезапуском сервисов {dv} при поступлении запроса.
// +
// .Диалог перезапуска сервисов {dv}
// image::install-restart-services.png[Диалог перезапуска сервисов {dv}]
// +
. Нажмите кнопку *Готово* для завершения работы мастера установки.
. Обновите БД через {cns}, подробнее процесс описан в документации модуля {pl}, раздел "xref:platform:console:db-update.adoc[]".

[#config]
== Конфигурация модуля {wc}

Все настройки модуля хранятся в конфигурационном файле модуля `appsettings.json`. Конфигурационный файл может быть изменён в любом текстовом редакторе, например `nano`.

[source,bash]
----
sudo nano /usr/lib/docsvision/webclient/appsettings.json
----

.appsettings.json
[source,json]
----
{
  "Docsvision": {
    "WebClient": {
      "Authentication": {
        "DefaultDomain": "DOMAIN.COM" <.>
      },
      "Server": {
        "SessionManagerConnection": {
          "ConnectionAddress": "http://dvserver.domain.com:5000"  <.>
        }
      }
    }
  },
  " Ldap": { <.>
    "AuthType": "Basic", <.>
    "Credential": {
      "UserName": "account@domain.com", <.>
      "Password": "password" <.>
    }
  },
  "DataProtectCertificateThumbprint": "thumbprint", <.>
  "SystemUserAccount": "account@domain.com", <.>
  "SystemUserPassword": "password", <.>
  "APIKEY": "api-key" <.>
}
----
<.> Домен по умолчанию.
<.> Адрес сервера {dv}.
<.> Имя и пароль учётной записи, под которой процесс обращается к ActiveDirectory.
<.> Тип аутентификации: `Basic` -- аутентификация через LDAP, `Oauth` -- аутентификация через ЕСИА или Azure.
<.> Логин пользователя модуля.
<.> Пароль учётной записи пользователя.
<.> Отпечаток закрытого ключа шифрования SHA1. +
Указывается без двоеточия, например, `D8602179888DC8402B393F11DCA16A3376DDF879`, см. подробнее в документации по установке системы, раздел "xref:6.1@install-linux::account-protection.adoc[]". +
Если шифровать пароль системной учётной записи не планируется, параметр можно удалить.
<.> Имя системной учётной записи {dv}
<.> Пароль системной учётной записи рекомендуется хранить в зашифрованном виде. Подробнее про шифрование см. в документации по установке системы, раздел "xref:install-linux::account-protection.adoc[]".
<.> Используется для подключения серверного расширения {wf}. Можно оставить значение по умолчанию или изменить, главное условие, чтобы значения в конфигурации модулей {wc}, {pl} и {wf} были одинаковые.

[#launch]
== Запуск службы

[source,bash]
----
sudo systemctl start dvwebclient
----
