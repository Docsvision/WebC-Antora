= Включить аутентификацию Kerberos

Чтобы иметь возможность использования сквозной аутентификации в Linux необходимо выполнить специальные настройки Kerberos и используемого браузера.

// . Настройте аутентификацию в Active Directory (требуется не для всех сервисов). Для работы Kerberos аутентификации в ActiveDirectory, необходимо получить keytab-файл.
// +
// Необходимо создать отдельную учетную запись пользователя ActiveDirectory, затем привязать к ней имя сервиса (SPN). SPN используется аутентификацией Kerberos для сопоставления экземпляра сервиса с учетной записью в ActiveDirectory.
// +
// Если машина доступна по определенному имени в домене и для неё зарезервирован статический IP, который не может быть выдан другой машине, или если машина сообщает свой адрес контроллеру домена, keytab-файл может быть создан для указанного имени.
// // +
// // В противном случае необходимо убедиться, что у машины статический MAC-адрес и создать A-запись в домене. После этого можно создавать keytab-файл.
// +
// Созданный keytab-файл необходимо скопировать по указанному пути:
// +
// [source,bash]
// ----
// sudo cp ~/your.keytab /etc/krb5.keytab
// ----
// +
// Если необходимо хранить keytab-файл в системе под другим именем, потребуется добавить переменную окружения `KRB5_KTNAME`. Подробности можно получить в документации на сайте "https://web.mit.edu/kerberos/krb5-1.12/doc/mitK5defaults.html[MIT Kerberos Documentation]".

// // tag::webconfig[]
// . Настройте _Service Principal Names_ для учетной записи пула приложений {wc}а. Для этого от имени администратора домена выполните команды:
// +
// [source]
// ----
// Setspn /s HTTP/webc company\webuser <.> <2>
// Setspn /s HTTP/webc.company.com company\webuser <3> <2>
// ----
// Замените:
// <.> _webc_ -- имя сервера {wc}а.
// <.> _company\webuser_ -- имя учётной записи, под которой работает пул приложений {wc}а.
// <.> _webc.company.com_ -- полное сетевое имя сервера {wc}а.
// +
// WARNING: Учетная запись пула должна быть доменной учётной записью, входить в группу локальных администраторов на сервере {wc}а -- *{dv-admins-serv}* и в группу _{dv-admins-dir}_.
// +
// . Включите аутентификацию Kerberos в конфигурационном файле {wc}а:
// .. Откройте конфигурационный файл `{webconfig}` в режиме редактирования.
// .. Перейдите к секции menu:configuration[location path="Account/LoginWindows"].
// .. Измените секцию следующим образом:
// +
// .Включение аутентификации Kerberos
// ====
// [source,xml]
// ----
// <location path="Account/LoginWindows">
//     <system.web>
//       <authorization>
//         <deny users="?" />
//         <allow users="*" />
//       </authorization>
//     </system.web>
//     <system.webServer>
//       <security>
//         <authentication>
//           <anonymousAuthentication enabled="false" />
//           <windowsAuthentication enabled="true" useKernelMode="false" useAppPoolCredentials="true">
//             <providers>
//               <clear />
//               <add value="Negotiate:Kerberos" />
//             </providers>
//           </windowsAuthentication>
//           <basicAuthentication enabled="false" />
//         </authentication>
//       </security>
//     </system.webServer>
// </location>
// ----
// ====
// // end::webconfig[]
// +
// NOTE: Чтобы исключить проблему с аутентификацией на каждом запросе при Kerberos-аутентификации в настройках IIS необходимо перевести Kerberos из режима *request-based* в режим *session-based*.
// +
// .. Сохраните изменения.
// . Очистите кэш браузера пользователей.
