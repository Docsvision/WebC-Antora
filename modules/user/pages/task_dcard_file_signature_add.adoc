
== Произвольное подписание документов

Пользователь может подписать электронной подписьюxref:#fntarg_1[^1^] (ЭП): основные и дополнительные файлы, атрибуты документа. Подписание выполняется с целью защиты данных карточки от изменений: после изменении данных ЭП станет недействительной.

Документ может быть подписан простой, усиленной или квалифицированной ЭП. Возможность подписание тем или иным видом ЭП регулируется настройками системы {dv}, а также наличием необходимых программных средств на компьютере пользователя.

В случае, если лицензия на компоненты КриптоПро CSP истекла, блокируется возможность добавления новых подписей. Проверка старых подписей с действующим сертификатом ЭП выполняется успешно в любом случае.

[[task_gr2_dnh_2p__notsupported]]
[NOTE]
====
[.note__title]#Важное замечание:#

Со стандартными настройками в {dv} не поддерживается подписание усиленной/квалифицированной ЭП файлов с размером больше 35 МБ.

Работа с ЭЦП на iOS/Android через интерфейс {wc}а не поддерживается, требуется использовать мобильное приложение.
====

Чтобы подписать документ, выполните следующие действия:

. [.ph .cmd]#xref:OpenCard.adoc[Откройте карточку] документа.#
. [.ph .cmd]#В разделе «Файлы» нажмите [.ph .menucascade]#[.ph .uicontrol]*image:buttons/butt_sing_file.png[image]* > [.ph .uicontrol]*Подписать*#.#
+
image::dcard_file_signature.png[[.fig--title-label]##Рис. 1. ##Подписание документов]
+
На экране появится окно [.keyword .wintitle]*Электронная подпись*.

image::dcard_file_signature_label_select.png[[.fig--title-label]##Рис. 2. ##Параметры электронно-цифровой подписи]
. [.ph .cmd]#Выберите метку для подписи.#
+
Метки используются для конкретизации решения сотрудника, подписавшего карточку документа. Если метки отсутствуют (в [.dfn .term]_Справочнике меток подписей_), поле выбора метки отображаться не будет.
. [.ph .cmd]#Выберите вариант подписания:#
* «Простая подпись» – документ будет подписан учетной записью сотрудника.
* «Выберите сертификат» – документ будет подписан усиленной подписью.
+
[NOTE]
====
[.note__title]#Прим.:# Для подписания усиленной подписью должны быть установлены компоненты, указанные в пункте xref:Install_cryptopro.adoc[Установка компонентов КриптоПро].
====
+
Выбор варианта подписания зависит от настроек [.dfn .term]_Справочника сотрудников_ и наличия действительных сертификатов в персональном хранилище пользователя:

* если компоненты, необходимые для подписания усиленной электронной подписью не установлены, в окне будет отображаться подсказка: `Не установлен компонент для использования                                     усиленной подписи` и в списке будет доступен только вариант «Простая подпись»;
* если компоненты установлены, то:
** Если в персональном хранилище есть только один действительный сертификат, в списке вариантов подписания будут присутствовать этот сертификат и «Простая подпись». Если сертификат не совпадает с указанным в справочнике сотрудников, дополнительно будет отображаться предупреждающее сообщение: `Сертификат в                                             персональном хранилище не совпадает с  указанным в                                             Справочнике сотрудников`;
** Если в персональном хранилище у пользователя есть несколько сертификатов, в списке будут присутствовать варианты: [.keyword .parmname]_Простая подпись_, название сертификата из [.dfn .term]_Справочника сотрудников_ (если он указан и найден в хранилище) и [.keyword .parmname]_Выберите сертификат_ (открывает окно выбора сертификата из списка действительных, установленных в персональном хранилище).
+
image::certList.png[[.fig--title-label]##Рис. 3. ##Окно выбора сертификата для подписания]
** Если в хранилище сертификатов нет, в окне будет отображено соответствующее сообщение.
** Квалифицированные сертификаты выделяются жирным.
. [.ph .cmd]#Если для наложения усиленной подписи требуется выбрать сертификат, кликните по строке с информацией о нем.#
. [.ph .cmd]#Нажмите на кнопку [.ph .uicontrol]*Подписать*.#
+
После подписания появится сообщение `Электронная подпись                         сформирована успешно`. Цвет значка image:buttons/butt_sing_file.png[image] сменится на чёрный.

Информация о подписях документа доступна в xref:task_dcard_file_signature_check.adoc[журнале наложенных подписей].

* *xref:task_dcard_file_signature_check.adoc[Журнал электронно-цифровых подписей]* +
* *xref:PrintDocumentWithSignature.adoc[Печать документа со штампом электронной подписи]* +
* *xref:ExportFilesWithSign.adoc[Выгрузка файлов с подписями]* +


xref:#fnsrc_1[^1^] Определяется настройками вида документа
