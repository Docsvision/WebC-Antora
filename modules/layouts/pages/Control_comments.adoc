
== Комментарии

Элемент управления *Комментарии* предназначен для просмотра и добавления комментариев в карточке.

image::control_comments.png[Элемент управления "Комментарии" в разметке карточки]

ЭУ может быть добавлен в разметку просмотра или редактирования.

Пользователь может добавлять новые комментарии, изменять и удалять существующие (собственные и чужие) при наличии прав на данные операции по ролевой модели безопасности.

Собственные комментарии отображаются с правой стороны, чужие -- с левой. При наличии прав на операции, над строкой комментария отображаются кнопки изменения и удаления. Если количество отображаемых комментариев ограничено (настраивается), над списком может отображаться ссылка для показа всех комментариев (с количеством скрытых комментариев).

Комментарии сортируются по порядку добавления. Автоматическое обновление списка комментариев не предусмотрено.

== Свойства

Общие::
Название ЭУ:::
Название типа элемента управления.
Название:::
Уникальное название элемента управления.
Внешний вид::
Заполнитель:::
Текст, отображаемый в поле для ввода комментария.
+
`*Локализуемый*`
Ширина блока комментария:::
Определяет ширину блока, в котором отображается отдельный комментарий, относительно ширины элемента управления. Используется для визуального разделения своих и чужих комментариев. Ширина по умолчанию -- 80%.
Данные::
Источник данных:::
Выбор секции и полей карточки с комментариями из данной или связанной карточки. Настройка осуществляется в форме, открываемой при нажатии кнопки image:buttons/bt_dots.png[Три точки]:
+
image::commentsSourceConfig.png[Окно настройки источника данных с комментариями]
+
Настройки источника содержат следующие элементы:
+
* Секция -- выбор секции с данными комментариев. Если к разметке подключены дополнительные источники данных, для выбора будут доступны секции карточки и дополнительных источников.
* Поле автора, Поле даты и Поле комментария -- выбор полей из выбранной секции, содержащих соответствующие секции.
+
Поведение::
Видимость:::
Настройка видимости. Элемент управления отображается в карточке, когда флаг установлен. Эелемент управления и любое его содержимое не отображаются, когда флаг снят.
+
`*Адаптивный*`
Добавление комментария:::
Выбор операции редактирования, которая должна быть доступна пользователю, для разрешения добавления комментариев. Если операция не выбрана, добавление комментариев разрешено.
Дополнительные css классы:::
Названия дополнительных классов CSS для изменения стиля элемента управления. Перечисляются через пробел.
Изменение всех комментариев:::
Выбор операции редактирования, которая должна быть доступна пользователю, для разрешения изменения/удаления любых (чужих и собственных) комментариев. Если операция не выбрана, изменение/удаление чужих и собственных комментариев разрешено.
Изменение только своих комментариев:::
Выбор операции редактирования, которая должна быть доступна пользователю, для разрешения изменения/удаления собственных комментариев. Если операция не выбрана и/или доступна операция редактирования всех комментариев, изменение/удаление собственных комментариев разрешено.
+
[#html]
Использовать HTML редактор:::
Свойство доступно для включения только, если в Панели управления {wc}ом включена экспериментальная функция "Контрол комментарии с html редактором". Включение данного свойства позволяет упоминать сотрудников в комментариях и форматировать текст комментария в процессе ввода.
Количество отображаемых комментариев:::
Максимальное количество (последних) отображаемых в списке комментариев. Если комментариев больше указанного числа, в ЭУ будет показана ссылка для показа всех комментариев.
Операция редактирования для видимости:::
Определяет операцию, которая должна быть доступна, чтобы ЭУ отображался для пользователя. Работа свойства зависит от значения свойства `*Видимость*`:
+
* Когда флаг `*Видимость*` установлен и выбрана _операция редактирования для видимости_, видимость элемента определяется исходя из доступности пользователю выбранной операции редактирования.
* Когда флаг `*Видимость*` установлен, и _операция редактирования для видимости_ НЕ выбрана, ЭУ отображается всегда.
* Когда флаг `*Видимость*` НЕ установлен, ЭУ всегда скрыт.
Отключен:::
Когда флаг установлен, отключается возможность изменить значения элемента управления. Работает совместно со свойством `*Операция редактирования*`:редактирование будет запрещено, если одно из свойств запрещает редактирование.
+
`*Адаптивный*`
Переходить по TAB:::
Флаг определяет последовательность перехода по ЭУ карточки при нажатии кнопки kbd:[TAB]. Если флаг установлен, переход по kbd:[TAB] разрешён.
Стандартный css класс:::
Название CSS класса, в котором определен стандартный стиль элемента управления.
События::
Перед добавлением комментария:::
Вызывается перед сохранением нового комментария.
Перед редактированием комментария:::
Вызывается перед сохранением изменений комментария.
Перед удалением комментария:::
Вызывается перед удалением комментария.
После смены данных:::
Вызывается после изменения содержимого элемента управления.
При добавлении комментария:::
Вызывается после добавления комментария.
При наведении курсора:::
Вызывается при входе курсора мыши в область элемента управления.
При отведении курсора:::
Вызывается, когда курсор мыши покидает область элемента управления.
При получении фокуса:::
Вызывается, когда элемент управления выбирается.
При потере фокуса:::
Вызывается, когда выбор переходит к другому элементу управления.
При редактировании комментария:::
Вызывается после изменения комментария.
При удалении комментария:::
Вызывается после удаления комментария.
При щелчке:::
Вызывается при щелчке мыши по любой области элемента управления.
