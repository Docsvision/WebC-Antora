
== Управление согласованием

Элемент управления [.ph .uicontrol]*Управление согласованием* предназначен для отправки документа на согласование и управления ходом активного согласования.

Элемент управления добавляет в карточку документа кнопку [.ph .uicontrol]*На согласование*/[.ph .uicontrol]*Управление* (название может быть настроено), при нажатии которой открывается боковая панель отправки или управления согласованием. На панели отображаются маршруты, которые были настроены с использованием средств модуля [.dfn .term]_Конструктор согласований_.

Содержимое панели определяется текущим состоянием согласования:

* при создании согласования на панели отображаются настройки маршрута, а также кнопки отправки и отмены отправки согласования:
+
image::controls_agreementmanagement_send.png[[.fig--title-label]##Рис. 1. ##Панель согласования при создании согласования]
* при управлении согласованием (если есть активное согласование) на панели отображаются настройки этапа согласования, а также кнопки управления согласованием:
+
image::controls_agreementmanagement_management.png[[.fig--title-label]##Рис. 2. ##Панель согласования при наличии активного согласования]

Фактический набор команд и настроек панели согласования, которые будут доступны пользователю, зависит от следующих факторов:

* текущее состояние согласования;
* доступность операции пользователю по автомату состояний и ролевой модели;
* настройки маршрута согласования,
* настройки элемента управления;
* настройки этапа согласования:
** для возможности исключения этапа из маршрута, в настройках этапа должен быть установлен флаг [.ph .uicontrol]*Разрешить исключение этапа из маршрута*;
** для возможности изменения длительности этап и списка согласующих, в настройках этапа должен быть установлен флаг [.ph .uicontrol]*Разрешить изменение параметров этапа*;
** для возможности изменения типа маршрута, в настройках этапа должны быть установлены флаги [.ph .uicontrol]*Разрешить изменение параметров этапа* и [.ph .uicontrol]*Разрешить редактирование типа маршрутизации*.

Данный ЭУ может быть добавлен только в разметку, предназначенную для просмотра карточек типа Документ.

=== Свойства

Общие::
  Название ЭУ;;
    Название типа элемента управления.
  Название;;
    Уникальное название элемента управления.
Внешний вид::
  Названия кнопок;;
    Настройка названий кнопок управления согласованием.
    +
    Локализованные названия кнопок настраиваются в форме, открываемой при нажатии кнопки image:buttons/bt_dots.png[Три точки]:
    +
    image::ct_agreementmanagement_setnames.png[[.fig--title-label]##Рис. 3. ##Форма настройки названий кнопок ЭУ "Управление согласованием"]
Поведение::
  Видимость;;
    Настройка видимости: флаг установлен – элемент управления отображается в карточке; флаг не установлен – элемент управления (а также его содержимое) не отображается в карточке.
    +
    [.dfn .term]_Адаптивный_.
  Дополнительные css классы;;
    Названия дополнительных классов CSS для изменения стиля элемента управления. Перечисляются через пробел.
  Запрос подтверждения при старте;;
    Настройка подтверждения отправки на согласование: флаг установлен - при отправке на согласование будет отображаться запрос на подтверждение отправки; флаг не установлен - согласование будет стартовать без дополнительного подтверждения.
  Использовать последних;;
    Если флаг установлен, при добавлении участников согласования отображаются последние выбранные исполнители.
  Операция для прекращения этапа;;
    Выбор операции, которая должна быть доступна пользователю для прекращения этапа согласования.
  Операция для старта согласования;;
    Выбор операции, которая должна быть доступна пользователю для запуска согласования.
  Операция для управления согласованием;;
    Выбор операции, которая должна быть доступна пользователю для управления согласованием.
  Операция редактирования для видимости;;
    Определяет операцию, которая должна быть доступна пользователю для показа данного элемента управления. Действие настройки зависит от значения настройки [.dfn .term]_Видимость_:
    +
    * флаг [.dfn .term]_Видимость_ установлен, [.dfn .term]_операция редактирования для видимости_ выбрана – видимость элемента определяется доступностью пользователю выбранной операции редактирования;
    * флаг [.dfn .term]_Видимость_ установлен, [.dfn .term]_операция редактирования для видимости_ НЕ выбрана – ЭУ всегда отображается;
    * флаг [.dfn .term]_Видимость_ НЕ установлен – ЭУ всегда скрыт.
  Отключен;;
    При установленном флаге отключает возможность изменения значения элемента управления. Работает совместно со свойством «Операция редактирования»: если одно из свойств запрещает редактирования – редактирование будет запрещено.
    +
    [.dfn .term]_Адаптивный_.
  Переходить по TAB;;
    Определяет пользовательскую последовательность очередности обхода карточки по кнопке [.ph .uicontrol]*TAB*. Флаг установлен – переход по кнопке [.ph .uicontrol]*TAB* разрешен.
  Режим;;
    Определяет режим отображения кнопок старта и управления согласованием. Возможные варианты:
    +
    * "Старт и Управление" - если согласование запущено, то отображаются кнопки управления согласованием; если согласование не запущено, то отображается кнопка запуска согласования;
    * "только Старт" - отображается только кнопка запуска согласования, если оно не запущено;
    * "только Управление" - отображаются только кнопки управления согласованием, если оно запущено.
  Стандартный css класс;;
    Название CSS класса, в котором определен стандартный стиль элемента управления.
  Управление согласованием;;
    Открывает форму настройки списка отображаемых в ЭУ кнопок управления согласованием: [.ph .uicontrol]*Остановить*, [.ph .uicontrol]*Отменить* и [.ph .uicontrol]*Завершить*.
    +
    image::ct_agreementmanagement_enablebuttons.png[[.fig--title-label]##Рис. 4. ##Форма настройки доступности кнопок управления согласованием ЭУ "Управление согласованием"]
    +
    Кнопки управления, с которых снят флаг, будут скрыты с панели управления согласованием.
    +
    Кнопка «Управление согласованием» недоступна, если параметр «Режим» в значении «только Старт».
  Формат отображения Согласующего;;
    Определяет формат отображения имен согласующих на панели согласования:
    +
    * ФИО
    * ФИО+Должность
    * Строка отображения - используется формат отображения, настроенный в [.dfn .term]_Справочнике сотрудников_
События::
  Перед добавлением участника согласования;;
    Вызывается перед добавление участника согласования.
  Перед изменением пути согласования;;
    Вызывается перед изменением пути согласования.
  Перед остановкой согласования;;
    Вызывается перед остановкой согласования.
  Перед остановкой Этапа;;
    Вызывается перед остановкой этапа согласования.
  Перед открытием панели согласования;;
    Вызывается перед открытием панели согласования.
  Перед отменой согласования;;
    Вызывается перед отменой согласования.
  Перед отменой старта согласования (закрытием панели);;
    Вызывается перед отменой старта согласования, перед закрытием панели согласования.
  Перед принудительным завершением согласования;;
    Вызывается перед принудительным завершением согласования.
  Перед продолжением согласования после паузы;;
    Вызывается перед продолжением согласования после паузы.
  Перед стартом согласования;;
    Вызывается перед стартом согласования.
  Перед удалением участника согласования;;
    Вызывается перед удалением участника согласования.
  После добавления участника согласования;;
    Вызывается после добавления участника согласования.
  После изменения пути согласования;;
    Вызывается после изменения пути согласования.
  После остановки Этапа;;
    Вызывается после остановки этапа согласования.
  После открытия панели согласования;;
    Вызывается после открытия панели согласования.
  После отмены старта согласования (закрытия панели);;
    Вызывается после отмены старта согласования, после закрытия панели согласования.
  После удаления участника согласования;;
    Вызывается после удаления участника согласования.
  При наведении курсора;;
    Вызывается при входе курсора мыши в область элемента управления.
  При отведении курсора;;
    Вызывается, когда курсор мыши покидает область элемента управления.
  При щелчке;;
    Вызывается при щелчке мыши по любой области элемента управления.

