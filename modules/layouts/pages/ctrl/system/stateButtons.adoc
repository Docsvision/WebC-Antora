= Автомат состояния

Элемент управления `_Автомат состояния_` предназначен для смены состояния карточки. Возможность смены состояния определяется автоматом состояний, настроенным в _Конструкторе состояний_ {dv} 5, и ролевой моделью.

.Пример элемента управления "Автомат состояний
image::controls_statemachine.png[Пример элемента управления "Автомат состояний"]

Количество отображаемых кнопок может ограничено настройкой `*Ограничение количества кнопок*`.

== Свойства

=== Общие

==== Название ЭУ

Название типа элемента управления.

==== Название

Уникальное название элемента управления.

=== Внешний вид

Вертикальная ориентация:::
Определяет формат отображения кнопок элемента управления.
* Когда флаг установлен, кнопки выстраиваются вертикально.
* Когда флаг не установлен, кнопки выстраиваются горизонтально.

`*Адаптивный*`


=== Данные

Операции:::
Выбор операций, из которых будет сформирован список отображаемых в элементе управления операций перехода.
+
.Окно "Выбор операций"
image::controls_statemachine_filter.png[Окно "Выбор операций"]
+
* Выбран -- Включает или выключает показ данной операции в элементе управления. Когда флаг установлен, доступность операции пользователю будет зависеть от прав пользователя и текущего состояния карточки.
* Отображаемое наименование -- название операции, с которым она будет отображаться в элементе управления. По умолчанию используются стандартные названия из _Конструктора состояний_.
* Подсказка -- текст, отображаемый при наведении курсора мыши на операцию.
* Отображение -- вариант отображения кнопки операции:
** Основной -- кнопка операции доступна по умолчанию. Цвет кнопки соответствует основному цвету типа текущей карточки.
** Второстепенный -- кнопка операции доступна по умолчанию; цвет кнопки -- серый.
** Скрытый -- кнопка операции по умолчанию скрыта -- для доступа пользователь должен нажать кнопку image:buttons/bt_kebab.png[Три вертикальные точки].
* Подтверждать -- включает/отключает подтверждение выполнения операции. Текст запроса может быть изменён на собственный с помощью функции, указанной в свойстве `*Функция генерации текста подтверждения*`.
+
Переключатель *Все доступные операции* / *Только выбранные операции* включает выбор всех операций из списка или только операций с флагом `*Выбран*`.
+
Изменить порядок отображения операций у пользователя можно с помощью кнопок *Вверх* / *Вниз*.
+
Итоговый список операций перехода, отображаемых в элементе управления, определяется настройками автомата состояний в _Конструкторе состояний_, правами пользователя согласно ролевой модели и списком операций, выбранных в данной настройке.

=== Поведение

==== Видимость

Настройка видимости. Элемент управления отображается в карточке, когда флаг установлен. Элемент управления и любое его содержимое не отображаются, когда флаг снят.

`*Адаптивный*`

==== Дополнительные css классы

Названия дополнительных классов CSS для изменения стиля элемента управления. Перечисляются через пробел.
Ограничение количества кнопок:::
Определяет максимальное количество одновременно отображаемых в ЭУ кнопок. Если число возможных (для карточки) операций перехода превышает установленное значение, последней будет добавлена кнопка image:buttons/bt_kebab.png[Три вертикальные точки]. При нажатии этой кнопки будут показаны оставшиеся кнопки перехода. Если ограничение отсутствует, отображаются все доступные операции.

==== Отключен

Когда флаг установлен, отключается возможность изменить значения элемента управления. Работает совместно со свойством `*Операция редактирования*`:редактирование будет запрещено, если одно из свойств запрещает редактирование.

`*Адаптивный*`

==== Переходить по TAB

Флаг определяет последовательность перехода по ЭУ карточки при нажатии кнопки kbd:[TAB]. Если флаг установлен, переход по kbd:[TAB] разрешён.

==== Стандартный css класс

Название CSS класса, в котором определен стандартный стиль элемента управления.
Функция генерации текста подтверждения:::
Название клиентской функции, возвращающей текст подтверждения, отображаемый при выборе операции с установленным флагом `*Подтверждать*`.
+
.Пример функции на TypeScript:
[source,typescript,l]
----
function createConfirmation(sender: StateButtons, operationDataModel: GenModels.OperationDataModel){
return "Подтвердите выполнение операции " + operationDataModel.displayName;
}
----

=== События

Перед выполнением операции:::
Вызывается после подтверждения операции пользователем и настройки выполнения операции на боковой панели (если используется).
Перед изменением состояния карточки:::
Вызывается перед выполнением операции изменения состояния карточки.
Перед отображением диалога параметров:::
Вызывается после подтверждения операции пользователем, до показа диалога настройки выполнения операции. Событие срабатывает только при наличии разметки настройки операции.
После изменения состояния карточки:::
Вызывается после выполнения операции изменения состояния карточки.
После нажатия на кнопку:::
Вызывается после нажатия на кнопку операции, до отображения окна подтверждения операции.
После отображения диалога параметров:::
Вызывается после показа диалога настройки выполнения операции. Событие срабатывает только при наличии разметки настройки операции.

==== При наведении курсора

Вызывается при входе курсора мыши в область элемента управления.

==== При отведении курсора

Вызывается, когда курсор мыши покидает область элемента управления.

==== При щелчке

Вызывается при щелчке мыши по любой области элемента управления.
