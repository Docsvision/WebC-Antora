= Добавление нового элемента управления

Добавить новый тип элементов управления в {kvr} можно с помощью расширения.

Расширение предоставляет возможность настраивать разметку с использованием нового элемента управления, но не обеспечивает его функционирование на клиентской стороне.

Полностью вопрос разработки новых типов элементов управления будет рассмотрен в разделе xref:new-controls/new-controls.adoc[Разработка элементов управления].

Основным способом описания элемента управления является текстовый или XML. Подробнее о создании текстового описателя элемента управления см. xref:new-controls/create-text-descriptor.adoc[].

== Добавить элемент управления

.Элемент управления из расширения в редакторе разметок
image::control-library.png[Элемент управления из расширения в редакторе разметок]

.Чтобы создать расширение, добавляющее новый тип элементов управления, выполните приведенную далее инструкцию.
. xref:layout-designer/create-publish.adoc[Создайте проект расширения программы {kvr}].
+
[#realize]
. Добавьте в ядро расширения (файл `DesignerExtension.cs`) функцию, предоставляющую _описатель элемента управления_.
+
Описатель элемента управления -- это объект, содержащий информацию об элементе управления: название типа, группа, перечень свойства (настроек). Описатель имеет тип `ControlTypeDescription`.
+
[source,csharp]
----
   ControlTypeDescription GetSuperControlTypeDescription () 
   {
     var controlTypeDescription = new ControlTypeDescription ("SuperControl") {
         DisplayName = "Супер элемент управления",
         ControlGroupDisplayName = "Примеры",
         PropertyDescriptions = {
             PropertyFactory.GetNameProperty(), <.>
             PropertyFactory.GetVisibilityProperty(), <.>
             PropertyFactory.GetClickEvent() <.>
         }
     };
     return controlTypeDescription;
   }
----
<.> Название.
<.> Видимость.
<.> Событие `*При щелчке*`.
+
.При составлении описания элемента необходимо:
****
[lowerroman]
. Указать название типа элемента управления. Название передается непосредственно в конструктор класса `ControlTypeDescription`.
+
.Описатель элемента управления с типом "SuperControl"
[source,csharp]
----
var controlTypeDescription = new ControlTypeDescription ("SuperControl"){}
----
+
. Указать отображаемое название типа элемента управления в DisplayName. Данное название приводится в строке `*Название ЭУ*` в блоке настроек элемента управления в программы {kvr}.
+
[source,csharp]
----
DisplayName = "Супер элемент управления",
----
+
. Указать группу элемента управления в ControlGroupDisplayName. Группа используется для группировки элементов управления в библиотеке элементов управления программы {kvr}.
+
[source,csharp]
----
ControlGroupDisplayName = "Примеры",
----
****
+
. Укажите свойства элемента управления в `PropertyDescriptions`.
+
****
Свойства элемента управления -- его параметры, которые определяют внешний вид, связь с данными карточки, функции, вызываемые при работе элемента управления (обработчики событий). К свойствам относятся: видимость, текстовая метка, подсказка, (событие) при получении фокуса и др. Значения свойств (есть исключения) передаются в клиент, где могут быть использованы для формирования пользовательского интерфейса.
****
+
. Переопределите метод `GetControlTypeDescriptions()` базового класса, чтобы он возвращал коллекцию с <<realize,реализованным>> в пункте 2 методом:
+
--
// no-code-check
[source,csharp]
----
protected override List<ControlTypeDescription> GetControlTypeDescriptions()
{
    return new List<ControlTypeDescription>
    {
        GetSuperControlTypeDescription()
    };
}
----
--
// +
// . Скомпилируйте проект и скопируйте полученную сборку на сервер {wc}а в папку ``Каталог-установки-Конструктора-Web-Разметок/Plugins/%Каталог Решения%`. Ресурсные сборки скопируйте в папки `{wcd}/ru/` (для русской локализации), `{wcd}/uk/` (для английской локализации) и т.д.
// . Перезапустите {kvr}.

// == Проверить элемент управления
//
// Для проверки примера, откройте настройки любой разметки. В библиотеке элементов управления будет доступен для использования `_Супер элемент управления_`.
//
// .Элемент управления из расширения в редакторе разметок
// image::control-library.png[Элемент управления из расширения в редакторе разметок]

// [NOTE]
// ====
// В данном пункте рассмотрен один из двух возможных вариантов регистрации нового типа элементов управления.
//
// Описатель элемента управления может также быть реализован в виде текстового XML файла. В таком файле перечисляются свойства данного элемента управления.
//
// Возможность создания описателя элемента управления рассмотрена в разделе xref:new-controls/new-controls.adoc[Разработка элементов управления].
// ====
