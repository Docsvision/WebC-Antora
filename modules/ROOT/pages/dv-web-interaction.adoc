= Взаимодействие {wc}а с программой DVWebTool

Программа _DVWebTool_ -- сервис, который выполняется на пользовательском компьютере и предоставляет возможность запускать определённые процессы с правами *текущего пользователя* Windows. Программа предоставляет {wc}у доступ к окружению пользователя: установленным программам, локальным и сетевым устройствам.

[NOTE]
====
include::ROOT:partial$excerpts.adoc[tags=dv-web-launch]
====

.Взаимодействие компонентов организовано следующим образом:
. Пользователь {wc}а инициирует операцию, требующую запуска процессов на компьютере пользователя. Например, вызов Microsoft Word для автоконсолидации версий документа.
. Веб-браузер пользователя подключается по локальному адресу к порту `5413`, который по умолчанию прослушивает программа _DVWebTool_. Подключение осуществляется по протоколу `WebSocket`.
. Веб-браузер вызывает требуемую функцию программы _DVWebTool_. Например, запускает Microsoft Word в режиме автоконсолидации документа.
. Программа _DVWebTool_ выполняет требуемую задачу.

.Схема взаимодействия программы DVWebTool с другими компонентами
image::dv-web-tool-schema.png[Схема взаимодействия программы DVWebTool с другими компонентами]

Программа _DVWebTool_ обеспечивает базовые функции взаимодействия с веб-браузером, функции для работы с окружением реализованы в расширениях программы. Расширения _DVWebTool_ могут вызывать функции программ с компьютера пользователя или устройств. Расширения _DVWebTool_ могут также выполнять другие операции, например, взаимодействовать с сетевыми ресурсами. Для реализации новых функций могут быть разработаны собственные расширения.

[#launch]
== Настройки запуска программы

Поведение программы по умолчанию: программа запускается при выполнении действия, а после выполнения не закрывается. Данное поведение можно изменить в конфигурационном файле {wc}а, расположенном по пути: `{webconfig}`. Настройки располагаются в группе:  menu:Docsvision[WebClient > SettingGroups > SettingGroup Name="WebClient"].

.Поведение DVWebTool настраивается в конфигурационном файле {wc}а:
* `DvWebToolAppShutDown` -- закрывать DVWebTool после выполнения действия. Значение по умолчанию: `false` -- не закрывать.
* `DvWebToolStartUpLaunch` -- отвечает за автоматический запуск DVWebTool. Значение по умолчанию: `true` -- утилита запускается автоматически при выполнении действия.

Чтобы настройки вступили в действие после изменения, необходимо повторно собрать инсталлятор DVWebTool -- запустить консоль настройки Web-клиента и нажать на кнопку "Пересобрать DVWebTool", либо запустить из настройку (xref:admin:settings-simple.adoc[простую] или xref:admin:setings-extended.adoc[расширенную]) и пройти её до второго шага.

[#consolidation]
== Алгоритм работы при создании объединенной версии согласуемого документа

Указанный далее алгоритм описывает механизм создания объединенной версии согласуемого документа при вызове данной функции пользователем.

. Из клиентской части {wc}а в программу _DVWebTool_ передается идентификатор карточки для консолидации.
. Программа _DVWebTool_ получает с сервера файлы для консолидации и средствами Microsoft Word выполняет слияние файлов. Результат передается на сервер.

NOTE: Для работы данного алгоритма важно, чтобы {wc} и программа _DVWebTool_ были запущены от имени одного сотрудника.

[#scan]
== Алгоритм работы при сканировании

. Из клиентской части {wc}а в программу _DVWebTool_ передается запрос на сканирование с параметрами сканирования.
. Программа _DVWebTool_ обращается к сканеру, получает с него результат и передаёт клиенту.
